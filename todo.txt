
**"Diagnosa dan perbaiki error yang terjadi pada aplikasi Laravel terkait dengan pencarian kolom `role` pada tabel `users`. Error yang muncul adalah `Unknown column 'role' in where clause` saat mencoba menjalankan query `select count(*) from users where role = mentor`. Saya sudah sepenuhnya beralih menggunakan **Spatie Laravel Permission** untuk manajemen role dan peran, jadi `role` seharusnya tidak lagi digunakan secara langsung dalam tabel `users`. Pastikan untuk melakukan perbaikan menyeluruh sebagai berikut:

1. **Periksa kode yang mengakses `role` pada query**:

   * Temukan bagian kode yang masih mencoba untuk mencari `role` langsung di tabel `users`, seperti pada query `User::where('role', 'mentor')`. Di kasus ini, pastikan Anda mengakses role menggunakan **Spatie** yang sesuai dengan tabel yang dibuat oleh Spatie (yaitu tabel `role_has_permissions` atau yang sejenisnya).
   * Periksa penggunaan `User::where('role', 'mentor')` pada file `app/Filament/Widgets/StatsOverview.php` atau file lain yang relevan.

2. **Ganti query yang masih menggunakan kolom `role` langsung**:

   * Gunakan metode Spatie untuk memeriksa apakah pengguna memiliki peran tertentu, seperti:

     ```php
     User::role('mentor')->count();
     ```

     atau

     ```php
     User::whereHas('roles', function($query) {
         $query->where('name', 'mentor');
     })->count();
     ```

3. **Periksa pengaturan Spatie di database dan model**:

   * Pastikan hubungan antara `User` dan `Role` sudah diatur dengan benar di dalam model `User`, dengan menggunakan Spatie Laravel Permission. Di model `User`, pastikan Anda sudah menambahkan `HasRoles` seperti ini:

     ```php
     use Spatie\Permission\Traits\HasRoles;

     class User extends Authenticatable
     {
         use HasRoles;
     }
     ```
   * Pastikan bahwa tabel `roles` dan `role_has_permissions` sudah ada dan berfungsi dengan baik.

4. **Uji aplikasi setelah perbaikan**:

   * Setelah mengganti query dan memastikan hubungan `role` dengan Spatie sudah benar, lakukan uji coba untuk memastikan aplikasi berjalan tanpa error dan peran (`role`) sudah dikelola dengan benar.

5. **Pastikan aplikasi tidak mengalami error setelah perbaikan**:

   * Jalankan kembali aplikasi dan lakukan pengecekan di bagian yang mengakses peran pengguna (`role`). Perbaiki jika ada kesalahan lain terkait dengan pengambilan peran atau query yang tidak sesuai dengan pengaturan Spatie.

6. **Jaga agar perbaikan ini tidak merusak fungsionalitas lain**:

   * Periksa jika ada kode lain yang juga mengakses kolom `role` atau menggunakan query terkait role di bagian lain aplikasi. Gantilah kode tersebut agar sesuai dengan cara Spatie mengelola role.

Berikan penjelasan terkait setiap langkah yang dilakukan dan pastikan bahwa perubahan yang dilakukan tidak merusak fungsionalitas aplikasi. Hindari perubahan yang dapat menyebabkan aplikasi tidak berjalan dengan semestinya, pastikan semua pengaturan role dan permission sesuai dengan penggunaan **Spatie Laravel Permission**."**


